{"ast":null,"code":"import _asyncToGenerator from\"/Users/song-wonjeong/Desktop/react-python/workspace/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/song-wonjeong/Desktop/react-python/workspace/node_modules/@babel/runtime/regenerator/index.js\";import React,{useRef,useEffect,useCallback}from'react';import Webcam from'react-webcam';import{jsx as _jsx}from\"react/jsx-runtime\";var WebcamApp=function WebcamApp(_ref){var selectedObject=_ref.selectedObject,objectCount=_ref.objectCount,shootingInterval=_ref.shootingInterval;// 웹캠 참조 객체를 생성합니다.\nvar webcamRef=useRef(null);useEffect(function(){// 웹캠에 대한 제약사항(constraints)을 정의합니다.\nvar constraints={video:true};// 웹캠에 접근하여 스트림을 받아옵니다.\nnavigator.mediaDevices.getUserMedia(constraints).then(function(stream){// 웹캠 컴포넌트의 스트림에 연결합니다.\nwebcamRef.current.stream=stream;}).catch(function(error){console.error('웹캠 접근 에러: '+error);});},[]);// 이미지를 저장하는 함수를 생성합니다.\nvar saveImageFunction=useCallback(function(){var link=document.createElement('a');link.href=webcamRef.current.getScreenshot();link.download=\"capture_\".concat(Date.now(),\".jpg\");link.click();},[webcamRef]);// 이미지를 서버로 전송하는 함수를 생성합니다.\nvar sendImageToServer=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var imageSrc,formData,response,data,detectedObjects,objectOccurrences;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(webcamRef.current){_context.next=2;break;}return _context.abrupt(\"return\");case 2:// 웹캠으로부터 이미지 스크린샷을 가져옵니다.\nimageSrc=webcamRef.current.getScreenshot();// FormData를 사용하여 이미지를 포함시킵니다.\nformData=new FormData();formData.append('image',imageSrc);_context.prev=5;_context.next=8;return fetch(\"http://localhost:8000/detect\",{method:\"POST\",body:formData});case 8:response=_context.sent;_context.next=11;return response.json();case 11:data=_context.sent;// 감지된 객체 목록을 가져옵니다.\ndetectedObjects=data.detected_objects;// 선택된 객체와 객체 수를 비교하여 이미지 저장 함수를 호출합니다.\nobjectOccurrences=detectedObjects.filter(function(obj){return obj===selectedObject;}).length;if(objectOccurrences>=objectCount){saveImageFunction();}_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](5);console.error(\"서버로 이미지 전송 에러: \",_context.t0);case 20:case\"end\":return _context.stop();}}},_callee,null,[[5,17]]);})),[selectedObject,objectCount,saveImageFunction]);useEffect(function(){// 주기적으로 이미지를 서버로 전송하는 인터벌을 설정합니다.\nvar interval=setInterval(function(){sendImageToServer();},shootingInterval*1000);// 컴포넌트가 언마운트될 때 인터벌을 클리어합니다.\nreturn function(){return clearInterval(interval);};},[shootingInterval,sendImageToServer]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Webcam,{ref:webcamRef,screenshotFormat:\"image/jpeg\",videoConstraints:{deviceId:0},width:500,height:\"auto\"})});};export default WebcamApp;","map":{"version":3,"sources":["/Users/song-wonjeong/Desktop/react-python/workspace/src/components/Skills/WebcamComponent.js"],"names":["React","useRef","useEffect","useCallback","Webcam","WebcamApp","selectedObject","objectCount","shootingInterval","webcamRef","constraints","video","navigator","mediaDevices","getUserMedia","then","stream","current","catch","error","console","saveImageFunction","link","document","createElement","href","getScreenshot","download","Date","now","click","sendImageToServer","imageSrc","formData","FormData","append","fetch","method","body","response","json","data","detectedObjects","detected_objects","objectOccurrences","filter","obj","length","interval","setInterval","clearInterval","deviceId"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useCallback } from 'react';\r\nimport Webcam from 'react-webcam';\r\n\r\nconst WebcamApp = ({ selectedObject, objectCount, shootingInterval }) => {\r\n    // 웹캠 참조 객체를 생성합니다.\r\n    const webcamRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        // 웹캠에 대한 제약사항(constraints)을 정의합니다.\r\n        const constraints = { video: true };\r\n\r\n        // 웹캠에 접근하여 스트림을 받아옵니다.\r\n        navigator.mediaDevices.getUserMedia(constraints)\r\n        .then((stream) => {\r\n            // 웹캠 컴포넌트의 스트림에 연결합니다.\r\n            webcamRef.current.stream = stream;\r\n        }).catch((error) => {\r\n            console.error('웹캠 접근 에러: ' + error);\r\n        });\r\n    }, []);\r\n\r\n    // 이미지를 저장하는 함수를 생성합니다.\r\n    const saveImageFunction = useCallback(() => {\r\n        const link = document.createElement('a');\r\n        link.href = webcamRef.current.getScreenshot();\r\n        link.download = `capture_${Date.now()}.jpg`;\r\n        link.click();\r\n    }, [webcamRef]);\r\n\r\n    // 이미지를 서버로 전송하는 함수를 생성합니다.\r\n    const sendImageToServer = useCallback(async () => {\r\n        if (!webcamRef.current) {\r\n            return;\r\n        }\r\n\r\n        // 웹캠으로부터 이미지 스크린샷을 가져옵니다.\r\n        const imageSrc = webcamRef.current.getScreenshot();\r\n\r\n        // FormData를 사용하여 이미지를 포함시킵니다.\r\n        const formData = new FormData();\r\n        formData.append('image', imageSrc);\r\n\r\n        try {\r\n            // 서버에 이미지를 POST로 전송합니다.\r\n            let response = await fetch(\"http://localhost:8000/detect\", {\r\n                method: \"POST\",\r\n                body: formData\r\n            });\r\n\r\n            // 서버에서 응답 데이터를 JSON 형식으로 파싱합니다.\r\n            let data = await response.json();\r\n\r\n            // 감지된 객체 목록을 가져옵니다.\r\n            const detectedObjects = data.detected_objects;\r\n\r\n            // 선택된 객체와 객체 수를 비교하여 이미지 저장 함수를 호출합니다.\r\n            const objectOccurrences = detectedObjects.filter(obj => obj === selectedObject).length;\r\n            if (objectOccurrences >= objectCount) {\r\n                saveImageFunction();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"서버로 이미지 전송 에러: \", error);\r\n        }\r\n    }, [selectedObject, objectCount, saveImageFunction]);\r\n\r\n    useEffect(() => {\r\n        // 주기적으로 이미지를 서버로 전송하는 인터벌을 설정합니다.\r\n        const interval = setInterval(() => {\r\n            sendImageToServer();\r\n        }, shootingInterval * 1000);\r\n\r\n        // 컴포넌트가 언마운트될 때 인터벌을 클리어합니다.\r\n        return () => clearInterval(interval);\r\n    }, [shootingInterval, sendImageToServer]);\r\n\r\n    return (\r\n        <div>\r\n            {/* 웹캠 컴포넌트를 렌더링합니다. */}\r\n            <Webcam\r\n                ref={webcamRef}\r\n                screenshotFormat=\"image/jpeg\"\r\n                videoConstraints={{ deviceId: 0 }}\r\n                width={500}\r\n                height=\"auto\"\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default WebcamApp;\r\n"]},"metadata":{},"sourceType":"module"}